import{n as t,s as a,J as e}from"./index-026c35aa.js";const r=[];function s(e,s=t){let n;const o=[];function i(t){if(a(e,t)&&(e=t,n)){const t=!r.length;for(let a=0;a<o.length;a+=1){const t=o[a];t[1](),r.push(t,e)}if(t){for(let t=0;t<r.length;t+=2)r[t][0](r[t+1]);r.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(a,r=t){const l=[a,r];return o.push(l),1===o.length&&(n=s(i)||t),a(e),()=>{const t=o.indexOf(l);-1!==t&&o.splice(t,1),0===o.length&&(n(),n=null)}}}}const n=s(0),o=s(""),i=s(null),l="https://api.todoist.com/rest/v1",c={2156538858:1,2156538859:2,2156538862:3,2156538864:5,2156538865:8},h=async()=>{let t={headers:{Authorization:`Bearer ${e(o)}`}};const a=await fetch(`${l}/tasks?filter=(today%20%7C%20overdue)%20%26%20(%401P%20%7C%20%402P%20%7C%20%403P%20%7C%20%405P%20%7C%20%408P)`,t);return await a.json()},u=async t=>{let a={method:"POST",headers:{Authorization:`Bearer ${e(o)}`}};const r=await fetch(`${l}/tasks/${t.id}/close`,a);if(!(await r.ok))throw new Error("Failed to complete task");await d($(t))},d=async t=>{let a=await f();a+=t;var r=await w();let s={method:"POST",headers:{Authorization:`Bearer ${e(o)}`,"Content-Type":"application/json"},body:JSON.stringify({content:a.toString()})};if(!(await fetch(`${l}/tasks/${r.id}`,s)).ok)throw new Error("Failed to update lifepoints")},f=async()=>{var t=await p();let a={headers:{Authorization:`Bearer ${e(o)}`}};const r=await fetch(`${l}/tasks?project_id=${t.id}`,a);let s=await r.json();return parseInt(s[0].content)},w=async()=>{var t=await p();let a={headers:{Authorization:`Bearer ${e(o)}`}};return(await m(`${l}/tasks?project_id=${t.id}`,a))[0]},p=async()=>{let t={headers:{Authorization:`Bearer ${e(o)}`}};return(await m(`${l}/projects`,t)).filter((t=>"_points"==t.name))[0]},$=t=>c[g(t)],g=t=>t.label_ids.length>0?t.label_ids[0]:null,y=()=>{localStorage.clear()},m=async(t,a)=>{var e="_req_cache_"+t,r=localStorage.getItem(e);if(r)return Promise.resolve(JSON.parse(r));var s=await fetch(t,a);return s.ok&&localStorage.setItem(e,JSON.stringify(await s.json())),await s.json()};export{o as a,u as b,y as c,h as f,f as g,c as l,i as m,n as p,s as w};
